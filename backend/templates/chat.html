{% extends "base.html" %}

{% block content %}
<div class="container">
    <div class="row">
        <div class="col-md-10 offset-md-1">
            <div id="memory-chat-container">
                <h2 class="mb-4">Memory Chatbot</h2>
                
                <div id="chat-messages">
                    <div class="chat-message bot-message mb-3 p-3 rounded bg-light">
                        <strong>Memory Assistant:</strong> Hello! I'm here to help you recall and explore your memories. What would you like to discuss?
                    </div>
                </div>
                
                <div id="chat-input-container" class="mt-3">
                    <div class="input-group">
                        <textarea id="chat-input" class="form-control" placeholder="Type your message..." rows="3"></textarea>
                        <button id="chat-send-btn" class="btn btn-primary ms-2">
                            <i class="fas fa-paper-plane"></i>
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block scripts %}
<script>
document.addEventListener('DOMContentLoaded', () => {
    const chatMessages = document.getElementById('chat-messages');
    const chatInput = document.getElementById('chat-input');
    const chatSendBtn = document.getElementById('chat-send-btn');

    function addMessage(message, sender) {
        const messageDiv = document.createElement('div');
        messageDiv.classList.add('chat-message', `${sender}-message`, 'mb-3', 'p-3', 'rounded');
        messageDiv.innerHTML = `
            <strong>${sender === 'bot' ? 'Memory Assistant' : 'You'}:</strong> 
            ${message}
        `;
        chatMessages.appendChild(messageDiv);
        chatMessages.scrollTop = chatMessages.scrollHeight;
    }

    chatSendBtn.addEventListener('click', sendMessage);
    chatInput.addEventListener('keypress', (e) => {
        if (e.key === 'Enter' && !e.shiftKey) {
            e.preventDefault();
            sendMessage();
        }
    });

    async function sendMessage() {
        const message = chatInput.value.trim();
        if (!message) return;

        // Add user message
        addMessage(message, 'user');
        chatInput.value = '';

        try {
            const response = await fetch('/memory-chat', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify({ message: message })
            });

            const result = await response.json();

            // Add bot response
            if (result.response) {
                addMessage(result.response, 'bot');
            }
        } catch (error) {
            console.error('Error:', error);
            addMessage('Sorry, there was an error processing your request.', 'bot');
        }
    }
});
</script>
{% endblock %}
